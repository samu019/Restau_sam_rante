{% extends 'restaurant/base_generic.html' %}
{% load static %}
{% csrf_token %}
{% block content %}
<div class="dashboard-container">
    <!-- Bienvenida Personalizada -->
    <div class="welcome-section bg-primary text-white p-4 rounded mb-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h2>
                    {% if restaurante %}
                    🎉 ¡Bienvenido, {{ user.username }}!
                    {% else %}
                    🚀 ¡Bienvenido a RestaurantPro!
                    {% endif %}
                </h2>
                <p class="mb-0">
                    {% if restaurante %}
                    Gestiona tu restaurante <strong>{{ restaurante.nombre }}</strong> desde aquí
                    {% else %}
                    Comienza creando tu primer restaurante para gestionar menús y pedidos
                    {% endif %}
                </p>
            </div>
            {% if not restaurante %}
            <div class="col-md-4 text-end">
                <a href="{% url 'solicitar_restaurante' %}" class="btn btn-warning btn-lg">
                    <i class="fas fa-crown me-2"></i>Crear Mi Restaurante
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    {% if restaurante %}
    <!-- ==================== USUARIOS CON RESTAURANTE ==================== -->
    
    <!-- Menú Hamburguesa del Dashboard -->
    <div class="dashboard-nav mb-4">
        <div class="nav-hamburger">
            <button class="btn btn-warning" type="button" data-bs-toggle="collapse" data-bs-target="#dashboardMenu">
                <i class="fas fa-bars me-2"></i>Menú de Gestión
            </button>
            
            <div class="collapse mt-3" id="dashboardMenu">
                <div class="card">
                    <div class="card-body">
                        <div class="row g-3">
                            <!-- Gestión de Platos -->
                            <div class="col-md-3">
                                <a href="{% url 'administrar_platos' %}" class="btn btn-outline-primary w-100 h-100 py-3">
                                    <i class="fas fa-utensils fa-2x mb-2"></i><br>
                                    🍽️ Gestionar Platos
                                </a>
                            </div>
                            
                            <!-- Gestión de Bebidas -->
                            <div class="col-md-3">
                                <a href="{% url 'administrar_bebidas' %}" class="btn btn-outline-success w-100 h-100 py-3">
                                    <i class="fas fa-wine-glass-alt fa-2x mb-2"></i><br>
                                    🥤 Bebidas y Refrescos
                                </a>
                            </div>
                            
                            <!-- Categorías -->
                            <div class="col-md-3">
                                <a href="{% url 'administrar_categorias' %}" class="btn btn-outline-info w-100 h-100 py-3">
                                    <i class="fas fa-list fa-2x mb-2"></i><br>
                                    📑 Gestionar Categorías
                                </a>
                            </div>
                            
                            <!-- Anuncios -->
                            <div class="col-md-3">
                                <a href="{% url 'administrar_anuncios' %}" class="btn btn-outline-warning w-100 h-100 py-3">
                                    <i class="fas fa-bullhorn fa-2x mb-2"></i><br>
                                    📢 Gestionar Anuncios
                                </a>
                            </div>
                            
                            <!-- Pedidos -->
                            <div class="col-md-3">
                                <a href="{% url 'pedidos' %}" class="btn btn-outline-danger w-100 h-100 py-3">
                                    <i class="fas fa-shopping-cart fa-2x mb-2"></i><br>
                                    📦 Ver Pedidos
                                </a>
                            </div>
                            
                            <!-- Perfil Restaurante -->
                            <div class="col-md-3">
                                <a href="{% url 'perfil_usuario' %}" class="btn btn-outline-dark w-100 h-100 py-3">
                                    <i class="fas fa-store fa-2x mb-2"></i><br>
                                    🏪 Mi Restaurante
                                </a>
                            </div>

                            <!-- Menú Público -->
                            <div class="col-md-3">
                                <a href="{% url 'menu_publico' restaurante.id %}" target="_blank" class="btn btn-outline-secondary w-100 h-100 py-3">
                                    <i class="fas fa-eye fa-2x mb-2"></i><br>
                                    👀 Ver Menú Público
                                </a>
                            </div>

                            <!-- Configuración -->
                            <div class="col-md-3">
                                <a href="{% url 'perfil_usuario' %}" class="btn btn-outline-primary w-100 h-100 py-3">
                                    <i class="fas fa-cog fa-2x mb-2"></i><br>
                                    ⚙️ Configuración
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Estadísticas Rápidas -->
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="stat-card text-center bg-white p-4 rounded shadow-sm">
                <div class="stat-icon text-primary mb-2">
                    <i class="fas fa-utensils fa-2x"></i>
                </div>
                <h3 class="text-primary">{{ total_platos }}</h3>
                <p class="mb-0 text-muted">Platos Activos</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card text-center bg-white p-4 rounded shadow-sm">
                <div class="stat-icon text-success mb-2">
                    <i class="fas fa-shopping-cart fa-2x"></i>
                </div>
                <h3 class="text-success">{{ pedidos_hoy }}</h3>
                <p class="mb-0 text-muted">Pedidos Hoy</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card text-center bg-white p-4 rounded shadow-sm">
                <div class="stat-icon text-warning mb-2">
                    <i class="fas fa-clock fa-2x"></i>
                </div>
                <h3 class="text-warning">{{ pedidos_pendientes }}</h3>
                <p class="mb-0 text-muted">Pedidos Pendientes</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card text-center bg-white p-4 rounded shadow-sm">
                <div class="stat-icon text-info mb-2">
                    <i class="fas fa-chart-line fa-2x"></i>
                </div>
                <h3 class="text-info">{{ ingresos_mes }} FCFA</h3>
                <p class="mb-0 text-muted">Ingresos del Mes</p>
            </div>
        </div>
    </div>

    <!-- Últimos Pedidos y Estadísticas -->
    <div class="row g-4">
        <!-- Últimos Pedidos -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-shopping-cart me-2"></i>Últimos Pedidos
                    </h5>
                </div>
                <div class="card-body">
                    {% if ultimos_pedidos %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Cliente</th>
                                    <th>Total</th>
                                    <th>Estado</th>
                                    <th>Fecha</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for pedido in ultimos_pedidos %}
                                <tr>
                                    <td><strong>#{{ pedido.id }}</strong></td>
                                    <td>{{ pedido.cliente.username|default:"Cliente" }}</td>
                                    <td><span class="badge bg-success">{{ pedido.total }} FCFA</span></td>
                                    <td>
                                        <span class="badge 
                                            {% if pedido.estado == 'ENTREGADO' %}bg-success
                                            {% elif pedido.estado == 'PREPARACION' %}bg-warning
                                            {% elif pedido.estado == 'PENDIENTE' %}bg-secondary
                                            {% else %}bg-info{% endif %}">
                                            {{ pedido.get_estado_display }}
                                        </span>
                                    </td>
                                    <td>{{ pedido.fecha_creacion|date:"d/m H:i" }}</td>
                                    <td>
                                        <a href="{% url 'pedido_resumen' pedido.id %}" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                        <h5>No hay pedidos recientes</h5>
                        <p class="text-muted">Los pedidos aparecerán aquí cuando los clientes realicen órdenes.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Panel Lateral -->
        <div class="col-lg-4">
            <!-- Platos Populares -->
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-star me-2"></i>Platos Más Populares
                    </h5>
                </div>
                <div class="card-body">
                    {% if platos_populares %}
                    <div class="list-group">
                        {% for plato in platos_populares %}
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">{{ plato.nombre }}</h6>
                                    <small class="text-muted">{{ plato.categoria.nombre }}</small>
                                </div>
                                <span class="badge bg-primary rounded-pill">
                                    {{ plato.total_pedidos|default:0 }}
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-muted text-center">No hay datos de popularidad</p>
                    {% endif %}
                </div>
            </div>

            <!-- Acciones Rápidas -->
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-bolt me-2"></i>Acciones Rápidas
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'administrar_platos' %}" class="btn btn-outline-primary">
                            <i class="fas fa-plus me-2"></i>Agregar Nuevo Plato
                        </a>
                        <a href="{% url 'administrar_anuncios' %}" class="btn btn-outline-warning">
                            <i class="fas fa-bullhorn me-2"></i>Crear Anuncio
                        </a>
                        <a href="{% url 'menu_publico' restaurante.id %}" target="_blank" class="btn btn-outline-success">
                            <i class="fas fa-external-link-alt me-2"></i>Ver Menú Público
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <!-- ==================== USUARIOS SIN RESTAURANTE ==================== -->
    
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card text-center border-0 shadow-lg">
                <div class="card-body py-5">
                    <div class="mb-4">
                        <i class="fas fa-store fa-5x text-primary mb-3"></i>
                        <h2 class="text-primary">🚀 Comienza Tu Restaurante Online</h2>
                        <p class="lead text-muted mb-4">
                            Crea tu presencia digital y comienza a recibir pedidos en línea
                        </p>
                    </div>

                    <!-- Tarjetas de Planes -->
                    <div class="row mb-5">
                        {% for plan in planes %}
                        <div class="col-md-6 mb-4">
                            <div class="card h-100 border-{% if forloop.first %}primary{% else %}success{% endif %} shadow-sm">
                                <div class="card-header bg-{% if forloop.first %}primary{% else %}success{% endif %} text-white py-3">
                                    <h4 class="mb-0">
                                        {% if forloop.first %}
                                        <i class="fas fa-star me-2"></i>
                                        {% else %}
                                        <i class="fas fa-crown me-2"></i>
                                        {% endif %}
                                        {{ plan.nombre }}
                                    </h4>
                                </div>
                                <div class="card-body text-center p-4">
                                    <div class="price-section mb-3">
                                        <h2 class="text-{% if forloop.first %}primary{% else %}success{% endif %} fw-bold">
                                            {{ plan.precio_mensual }} FCFA
                                        </h2>
                                        <small class="text-muted">/mes</small>
                                        {% if plan.precio_anual %}
                                        <div class="mt-2">
                                            <small class="text-success">
                                                <strong>{{ plan.precio_anual }} FCFA</strong> anual (Ahorra 2 meses)
                                            </small>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <p class="text-muted mb-3">{{ plan.descripcion }}</p>
                                    <ul class="list-unstyled text-start mb-4">
                                        <li class="mb-2">
                                            <i class="fas fa-check text-success me-2"></i>
                                            Menú digital personalizado
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-check text-success me-2"></i>
                                            Sistema de pedidos en línea
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-check text-success me-2"></i>
                                            Panel de administración
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-check text-success me-2"></i>
                                            Soporte técnico incluido
                                        </li>
                                        {% if forloop.last %}
                                        <li class="mb-2">
                                            <i class="fas fa-check text-success me-2"></i>
                                            Anuncios promocionales
                                        </li>
                                        <li class="mb-2">
                                            <i class="fas fa-check text-success me-2"></i>
                                            Estadísticas avanzadas
                                        </li>
                                        {% endif %}
                                    </ul>
                                </div>
                                <div class="card-footer bg-transparent">
                                    <a href="{% url 'solicitar_restaurante' %}" class="btn btn-{% if forloop.first %}primary{% else %}success{% endif %} w-100 btn-lg">
                                        <i class="fas fa-rocket me-2"></i>
                                        Elegir {{ plan.nombre }}
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Información de Pagos -->
                    <div class="row">
                        <div class="col-md-8 mx-auto">
                            <div class="alert alert-info">
                                <h5>💡 ¿Cómo Funciona?</h5>
                                <ol class="mb-0 text-start">
                                    <li class="mb-2"><strong>Elige tu plan</strong> - Selecciona el que mejor se adapte a tu negocio</li>
                                    <li class="mb-2"><strong>Realiza el pago</strong> - Transferencia, USDT o Binance Pay</li>
                                    <li class="mb-2"><strong>Sube comprobante</strong> - Verificamos tu pago en 24-48 horas</li>
                                    <li class="mb-2"><strong>¡Configura!</strong> - Accede a tu panel y personaliza tu restaurante</li>
                                    <li class="mb-0"><strong>¡Comienza!</strong> - Recibe pedidos y haz crecer tu negocio</li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <!-- Métodos de Pago -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <h5 class="mb-3">💳 Métodos de Pago Aceptados</h5>
                            <div class="d-flex justify-content-center gap-4 flex-wrap">
                                <div class="payment-method text-center">
                                    <i class="fas fa-university fa-2x text-primary mb-2"></i>
                                    <p class="mb-0 small">Transferencia<br>Bancaria</p>
                                </div>
                                <div class="payment-method text-center">
                                    <i class="fab fa-bitcoin fa-2x text-warning mb-2"></i>
                                    <p class="mb-0 small">USDT<br>(TRC20)</p>
                                </div>
                                <div class="payment-method text-center">
                                    <i class="fas fa-wallet fa-2x text-success mb-2"></i>
                                    <p class="mb-0 small">Binance<br>Pay</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Botón Principal -->
                    <div class="text-center mt-5">
                        <a href="{% url 'solicitar_restaurante' %}" class="btn btn-primary btn-lg px-5 py-3">
                            <i class="fas fa-rocket me-2"></i>
                            Comenzar Ahora - Elegir Plan
                        </a>
                        <div class="mt-2">
                            <small class="text-muted">Garantía de reembolso si no es aprobado</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
.dashboard-container {
    padding: 20px 0;
    min-height: 80vh;
}

.welcome-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
}

.stat-card {
    border: 1px solid #e9ecef;
    transition: all 0.3s ease;
    border-radius: 12px;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.stat-card h3 {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.stat-icon {
    opacity: 0.8;
}

.nav-hamburger .btn {
    border-radius: 50px;
    padding: 0.75rem 2rem;
    font-weight: 600;
}

.dashboard-nav .card-body .btn {
    padding: 1.5rem 0.5rem;
    border-radius: 12px;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.dashboard-nav .card-body .btn:hover {
    transform: scale(1.05);
    border-color: #007bff;
}

.payment-method {
    padding: 1rem;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    transition: all 0.3s ease;
    min-width: 100px;
}

.payment-method:hover {
    border-color: #007bff;
    background-color: #f8f9fa;
}

.price-section {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 1.5rem;
    border-radius: 10px;
    margin: 1rem 0;
}

/* Responsive */
@media (max-width: 768px) {
    .dashboard-nav .card-body .btn {
        padding: 1rem 0.5rem;
        font-size: 0.9rem;
    }
    
    .stat-card h3 {
        font-size: 2rem;
    }
    
    .welcome-section .btn {
        width: 100%;
        margin-top: 1rem;
    }
}
</style>
{% endblock %}